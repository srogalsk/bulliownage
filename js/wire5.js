Parse.initialize("lvKnEQfyaRezqqgnktnDZhTZQP3Yf9cpJV1lDXzf",
    "nKE6VI1LruKg7LMkpRmNin4IqldZfIYvE7KyyKCd");

// Default Selections for user
var nugget =
{
    type: "gold",
    name: "Australian Gold Nugget",
    percent: 0.9999,
    weight: 0.05
}

var lunar1 =
{
    type: "gold",
    name: "Lunar Series I",
    percent: 0.9999,
    weight: 1
}
var lunar2 =
{
    type: "gold",
    name: "Lunar Series II",
    percent: 0.9999,
    weight: 0.05
}
var vienna =
{
    type: "gold",
    name: "Vienna Philharmonic",
    percent: 0.9999,
    weight: 0.1
}
var maple =
{
    type: "gold",
    name: "Canadian Maple Leaf",
    percent: 0.9999,
    weight: 0.067
}
var panda =
{
    type: "gold",
    name: "Gold Panda",
    percent: 0.999,
    weight: 0.05
}
var napoleon =
{
    type: "gold",
    name: "Napoleon",
    percent: 0.900,
    weight: 0.1867
}
var david =
{
    type: "gold",
    name: "Tower of David",
    percent: 0.9999,
    weight: 1
}
var ibris =
{
    type: "gold",
    name: "Golden Ibris",
    percent: 0.9999,
    weight: 0.1
}
var kijang =
{
    type: "gold",
    name: "Kijang Emas",
    percent: 0.9999,
    weight: 0.25
}
var libertad =
{
    type: "gold",
    name: "Gold Libertad",
    percent: 0.999,
    weight: 0.05
}
var centenario =
{
    type: "gold",
    name: "Centenario",
    percent: 0.900,
    weight: 1.20565
}

var orzel =
{
    type: "gold",
    name: "Orzel Bielik",
    percent: 0.9999,
    weight: 0.1
}

var bene =
{
    type: "gold",
    name: "Bene Merentibus",
    percent: 0.9999,
    weight: 0.5
}

var george =
{
    type: "gold",
    name: "Saint George the Victorious",
    percent: 0.999,
    weight: 0.2537
}

var elephant =
{
    type: "gold",
    name: "Elephant",
    percent: 0.999,
    weight: 0.02
}

var krugerrand =
{
    type: "gold",
    name: "Krugerrand",
    percent: 0.9167,
    weight: 0.1
}

var vreneli =
{
    type: "gold",
    name: "Vreneli",
    percent: 0.900,
    weight: 0.1866
}

var archangel =
{
    type: "gold",
    name: "Archangel Michael",
    percent: 0.9999,
    weight: 0.1
}

var sovereign =
{
    type: "gold",
    name: "Sovereign",
    percent: 0.9167,
    weight: 0.2354
}

var britannia =
{
    type: "gold",
    name: "Britannia",
    percent: 0.9999,
    weight: 1
}

var eagle =
{
    type: "gold",
    name: "US Eagle",
    percent: 0.9167,
    weight: 0.1
}

var buffalo =
{
    type: "gold",
    name: "American Buffalo",
    percent: 0.9999,
    weight: 1
}

var doubleEagle =
{
    type: "gold",
    name: "Double Eagle",
    percent: 0.900,
    weight: 0.9675
}

var chervonets =
{
    type: "gold",
    name: "Chervonets",
    percent: 0.900,
    weight: 0.2489
}

var koala =
{
    type: "platinum",
    name: "Platinum Koala",
    percent: 0.9995,
    weight: 0.05
}

var platypus =
{
    type: "platinum",
    name: "Platinum Platypus",
    percent: 0.9995,
    weight: 1
}

var leaf =
{
    type: "platinum",
    name: "Platinum Maple Leaf",
    percent: 0.9995,
    weight: 0.05
}

var noble =
{
    type: "platinum",
    name: "Noble",
    percent: 0.9995,
    weight: 0.05
}

var pLibertad =
{
    type: "platinum",
    name: "Platinum Libertad",
    percent: 0.999,
    weight: 0.25
}

var pEagle =
{
    type: "platinum",
    name: "Platinum Eagle",
    percent: 0.9995,
    weight: 0.1
}

var ark =
{
    type: "silver",
    name: "Noah's Ark",
    percent: 0.999,
    weight: 0.25
}

var kangaroo =
{
    type: "silver",
    name: "Kangaroo",
    percent: 0.999,
    weight: 1
}

var gorilla =
{
    type: "silver",
    name: "Cross River Gorilla",
    percent: 0.999,
    weight: 1
}

var fox =
{
    type: "silver",
    name: "Arctic Fox",
    percent: 0.9999,
    weight: 1.5
}

var lion =
{
    type: "silver",
    name: "African Lion",
    percent: 0.999,
    weight: 5
}

var lutra =
{
    type: "silver",
    name: "Otter Lutra",
    percent: 0.999,
    weight: 1
}

var scorpion =
{
    type: "silver",
    name: "Scorpion",
    percent: 0.999,
    weight: 1
}

var dragon =
{
    type: "silver",
    name: "The Great Dragon",
    percent: 0.999,
    weight: 0.5
}

var fortuna =
{
    type: "gold",
    name: "Gold Fortuna",
    percent: 0.999,
    weight: 0.5
}

var perth =
{
    type: "gold",
    name: "Gold Perth Mint Bar",
    percent: 0.999,
    weight: 1
}

var cast =
{
    type: "gold",
    name: "Gold Cast",
    percent: 0.999,
    weight: 1
}

var goat =
{
    type: "gold",
    name: "Lunar Goat",
    percent: 0.999,
    weight: 1
}

var eureka =
{
    type: "silver",
    name: "Eureka",
    percent: 0.999,
    weight: 1
}

var southern =
{
    type: "silver",
    name: "Southern Cross Minted Silver Bar",
    percent: 0.999,
    weight: 10
}

var old =
{
    type: "silver",
    name: "Silver Bar Old Style",
    percent: 0.999,
    weight: 100
}

var engelhard =
{
    type: "platinum",
    name: "Engelhard",
    percent: 0.9995,
    weight: 1
}

var valcambi =
{
    type: "platinum",
    name: "Platinum Valcambi",
    percent: 0.9995,
    weight: 1
}

var pFortuna =
{
    type: "platinum",
    name: "Platinum Fortuna",
    percent: 0.9995,
    weight: 10
}



var goldArr = [[nugget.name, lunar1.name, lunar2.name, vienna.name, maple.name, panda.name, napoleon.name, david.name,
    ibris.name, kijang.name, libertad.name, centenario.name, orzel.name, bene.name, george.name,
    elephant.name, krugerrand.name, vreneli.name, archangel.name, sovereign.name, britannia.name,
    eagle.name, buffalo.name, doubleEagle.name, chervonets.name, fortuna.name, perth.name, cast.name, goat.name],
    [nugget, lunar1, lunar2, vienna, maple, panda, napoleon, david, ibris, kijang, libertad, centenario, orzel, bene,
        george, elephant, krugerrand, vreneli, archangel, sovereign, britannia, eagle, buffalo, doubleEagle, chervonets,
        fortuna, perth, cast, goat]];

var silverArr = [[ark.name, kangaroo.name, gorilla.name, fox.name, lion.name, lutra.name, scorpion.name, dragon.name,
    eureka.name, southern.name, old.name],
    [ark, kangaroo, gorilla, fox, lion, lutra, scorpion, dragon, eureka, southern, old]];
var platArr = [[koala.name, platypus.name, leaf.name, noble.name, pLibertad.name, pEagle.name, engelhard.name,
    valcambi.name, pFortuna.name],
    [koala, platypus, leaf, noble, pLibertad, pEagle, engelhard, valcambi, pFortuna]];

var type;

function emptyList( box ) {
    // Set each option to null thus removing it
    while ( box.options.length ) box.options[0] = null;
}

function fillList( box, arr ) {
// arr[0] holds the display text
// arr[1] are the values

    for ( i = 0; i < arr[0].length; i++ ) {

        // Create a new drop down option with the
        // display text and value from arr
        option = new Option( arr[0][i], arr[1][i] );

        // Add to the end of the existing options
        box.options[box.length] = option;
    }
    // Preselect option 0
    box.selectedIndex=0;
}

changeList = function () {
    var category = document.getElementById("category");
    var newlist;
    switch (category.value) {
        case "gold":
            newlist = goldArr;
            type = "gold";
            break;
        case "silver":
            newlist = silverArr;
            type = "silver";
            break;
        case "platinum":
            newlist = platArr;
            type = "plat";
            break;
        default:
            newlist = goldArr;
            type = "gold";
            break;
    }

    emptyList(document.getElementById("type"));
    fillList(document.getElementById("type"), newlist);

    var name = $("#type option:selected").text();

    var img = "images/" + name + ".jpg";
    $(".coin_img")[0].setAttribute("src", img);

    metal = $("#category option:selected").text()
    $("#metalpercent").text(metal + " %");
    $("#metalozt").text(metal + " ozt/u");
    $("#metalgrams").text(metal + " g/u");
}

changeValue = function()
{
    var arr;

    if(type == "gold") {
        arr = goldArr;
    }
    else if(type == "silver")
    {
        arr = silverArr;
    }
    else{
        arr = platArr;
    }

    var name = $("#type option:selected").text();

    for (i = 0; i < arr[0].length; i++) {
        // Create a new drop down option with the
        // display text and value from arr
        var coin_obj = arr[1][i];
        if(name == coin_obj.name) {
            document.getElementById("percent").innerHTML = coin_obj.percent.toFixed(4);
            document.getElementById("ozt").innerHTML = coin_obj.weight.toFixed(4);
            invalid();
            break;
        }
    }

    var img = "images/" + name + ".jpg";
    $(".coin_img")[0].setAttribute("src", img);

    metal = $("#category option:selected").text()
    $("#metalpercent").text(metal + " %");
    $("#metalozt").text(metal + " ozt/u");
    $("#metalgrams").text(metal + " g/u");
}


function invalid() {
    var quantity = Number(document.getElementById("quantity").value);
    var premium = Number(document.getElementById("premium").value);
	var percent = Number(document.getElementById("percent").innerHTML);
    var unitgoldozt = Number(document.getElementById("ozt").innerHTML);
    var unitgrams = unitgoldozt / 0.032151;
    var unitgoldgrams = percent * unitgrams;
    var totalgoldozt = $("#ozt").text() * quantity;
    var invalid = isNaN(quantity) || quantity < 1 || isNaN(premium) || premium < 0;
    document.getElementById("unitgrams").innerHTML = invalid? "N/A" : unitgrams.toFixed(2);
    document.getElementById("grams").innerHTML = invalid? "N/A" : unitgoldgrams.toFixed(2);
    document.getElementById("total").innerHTML = invalid? "N/A" : totalgoldozt.toFixed(2);
    return invalid;
}

function saveToStack() {

    if (!invalid()) {
        var user = Parse.User.current();
        var Coin = Parse.Object.extend("Coin");
        var coin = new Coin();

        var select = document.getElementById("category");
        coin.set("metal", select.options[select.selectedIndex].text);
        coin.set("name", $("#type option:selected").text());
        coin.set("purchasedAt", new Date(document.getElementById("purchase_date").value));
        coin.set("quantity", Number(document.getElementById("quantity").value));
        coin.set("premium", Number(document.getElementById("premium").value));
        coin.set("percent", Number(document.getElementById("percent").innerHTML));
        coin.set("grams", Number(document.getElementById("grams").innerHTML));
        coin.set("owner", user.id);

        coin.save(null, {
            success: function(coin) {
                var metal = select.options[select.selectedIndex].text;
		        if (metal == "Gold") {
                    window.location = "wire3.html";
                } else if (metal == "Silver") {
                    window.location = "wire3b.html";
                } else if (metal == "Platinum") {
                    window.location = "wire3c.html";
                }
                alert("Bullion added successfully");
            },
            error: function(coin, error) {
                alert("Invalid information");
            }
        });
    } else {
        alert("Invalid information");
    }
}

var user = Parse.User.current();
if (user == null) {
	window.location = "login.html";
}

changeList();
changeValue();
invalid();
table = document.addEventListener("keyup", invalid);
table = document.addEventListener("onchange", changeValue);
table = document.addEventListener("onchange", changeList);
