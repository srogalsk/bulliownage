<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta name="description" content="bullion management site, rare coins, gold, silver, platinum">
    <meta name="author" content="CSE134B Dream Team">
    <link rel="stylesheet" type="text/css" href="./style/style.css">
    <meta name=viewport content="width=device-width, initial-scale=.8, minimum-scale = .8, user-scalable=yes">
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <script src="./js/jquery-1.11.2.min.js"></script>
    <script src="./js/Chart.js"></script>
    <script src="./js/main.js"></script>
    <title>My Gold - BULLIOWNAGE</title>
</head>

<body>
    <script type="text/javascript">
    loadTopNav();
    </script>
    <script type="text/javascript">
    loadSideNav(1);
    </script>
    <section class="main-section">
        <section class="coin_wrapper">
            <div class="mobile-nav">
                <a href="wire2.html">
                    <svg class="icon icon-keyboard-arrow-left">
                        <symbol id="icon-keyboard-arrow-left" viewBox="0 0 1024 1024">
                            <title>keyboard-arrow-left</title>
                            <path class="path1" d="M657.707 696.96l-195.627-195.627 195.627-195.627-60.373-60.373-256 256 256 256z"></path>
                        </symbol>
                        <use xlink:href="#icon-keyboard-arrow-left"></use>
                    </svg>
                </a>
                MY GOLD
                <a href="wire5.html">
                    <svg class="icon icon-add">
                        <symbol id="icon-add" viewBox="0 0 1024 1024">
                            <title>add</title>
                            <path class="path1" d="M810.667 554.667h-256v256h-85.333v-256h-256v-85.333h256v-256h85.333v256h256v85.333z"></path>
                        </symbol>
                        <use xlink:href="#icon-add"></use>
                    </svg>
                </a>
            </div>
            <section class="overview-panel">
                <section class="total-value">
                    <div class="total-dollars">$18,234.10</div>
                    <table class="current_gold">
                        <tr>
                            <td>Daily</td>
                            <td  class="pos-change" id="oneDayChange"></td>
                        </tr>
                        <tr>
                            <td>Overall</td>
                            <td class="pos-change" id="overallChange"></td>
                        </tr>
                    </table> 
                    <div class="total-label" id="my_gold_value">My Gold Value</div>

                </section>
                <section class="mobile-toggle">
                    <div class="mobile-toggle-button mtb-1 mobile-toggle-selected">
                        <svg class="icon icon-menu">
                            <symbol id="icon-menu" viewBox="0 0 1024 1024">
                                <title>menu</title>
                                <path class="path1" d="M128 768h768v-85.333h-768v85.333zM128 554.667h768v-85.333h-768v85.333zM128 256v85.333h768v-85.333h-768z"></path>
                            </symbol>
                            <use xlink:href="#icon-menu"></use>
                        </svg>
                    </div>
                    <div class="mobile-toggle-button mtb-2">
                        <svg class="icon icon-graph">
                            <symbol id="icon-graph" viewBox="0 -200 1424 1424">
                                <title>graph</title>
                                <path class="path1" d="M704 256h-192v640h192v-640zM960 448h-192v448h192v-448zM64 960v-128h64v-64h-64v-128h64v-64h-64v-128h64v-64h-64v-128h64v-64h-64v-128h64v-64h-128v1024h1024v-64h-960zM448 576h-192v320h192v-320z"></path>
                            </symbol>
                            <use xlink:href="#icon-graph"></use>
                        </svg>
                    </div>
                </section>
                <section class="market-list">
                    <section class="market-item-header" id="current-spot">
                        Current Spot
                    </section>
                    <section class="market-item-stats">
                        <table>
                            <tr>
                                <td id="bidVal"></td>
                                <td id="askVal"></td>
                                <td class="pos-change" id="changeAmount"></td>
                            </tr>
                            <tr>
                                <td>Bid</td>
                                <td>Ask</td>
                                <td>Daily Change</td>
                            </tr>
                        </table>
                    </section>
                </section>
            </section>
            <section class="graph-panel">
                <section class="chart-legend">
                    <div class="legend-left-half">
                        <section class="legend-item">
                            <div class="legend-item-color" id="legend-1"></div>
                            Gold Total
                        </section> 
                    </div>
                    <div class="legend-right-half">      
                        <section class="legend-item">
                            <div class="legend-item-color" id="legend-4"></div>
                            1t oz Gold
                        </section>
                    </div>    
                </section>
                <div class="chart-y-label">PRICE (Dollars)</div>
                <div class="chart-x-label">Day (Weekly)</div>
                <section class="chart-wrap">
                    <canvas id="total-chart"></canvas>
                </section>
            </section>

            <section class="my_stack">
                <table id="gold_table">
                    <caption>
                        <section class="label-and-search">
                            <h3>My Gold</h3>
                            <div class="stack_ctrl">
                                <input type="search" placeholder="Search" id="search"/>
                                <a href="wire5.html">
                                    <svg enable-background="new 0 0 24 24" height="24px" id="Layer_1" version="1.1" viewBox="0 0 24 24" width="24px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                        <path clip-rule="evenodd" d="M22.5,14H14v8.5c0,0.276-0.224,0.5-0.5,0.5h-4C9.224,23,9,22.776,9,22.5V14H0.5  C0.224,14,0,13.776,0,13.5v-4C0,9.224,0.224,9,0.5,9H9V0.5C9,0.224,9.224,0,9.5,0h4C13.776,0,14,0.224,14,0.5V9h8.5  C22.776,9,23,9.224,23,9.5v4C23,13.776,22.776,14,22.5,14z" fill-rule="evenodd" fill="white" />
                                    </svg>
                                </a>
                            </div>
                        </section>
                    </caption>
                    <thead>
                        <tr>
                            <th class="stack_img_col">Image</th>
                            <th>Item</th>
                            <th>Qty.</th>
                            <th class="weight_compr"><span>Weight/unit (g)</span></th>
                            <th class="percent_compr"><span>% au</span></th>
                            <th>Value</th>
                        </tr>
                    </thead>
                </table>
            </section>
        </section>
    </section>
    <script type="text/javascript">
    loadFooter();
    </script>
</body>

    <script>
    // Populate Data
        var json_obj_daily=Get("https://www.quandl.com/api/v1/datasets/LBMA/GOLD.json?auth_token=F1s2QQVicUxmZi2jGRjz&trim_start=",1);
        // Collect Critical Data points
        var recentVal=json_obj_daily.data[0][1];
        var recentVal2=json_obj_daily.data[1][1];
        var datalen=json_obj_daily.data.length;
        var oldestVal=json_obj_daily.data[datalen-1][1];

        // Calculate the 1D percentage change 
        var oneDayChange=(100*((recentVal-recentVal2)/recentVal2));
        // Round two digits
        oneDayChange=Number(Math.round(oneDayChange+'e'+2)+'e-'+2);

        // Calculate the overall change over the graph's timespan
        var overallChange=(100*((recentVal-oldestVal)/oldestVal));
        // Round two digits
        overallChange=Number(Math.round(overallChange+'e'+2)+'e-'+2);
        
        // Calculate sign extension and add to html
        var sign1, sign2;
        sign1 = (oneDayChange < 0 ? "" : "+");
        sign2 = (overallChange < 0 ? "" : "+");
        var ODC = document.getElementById("oneDayChange");
        ODC.className = (oneDayChange < 0 ? "neg-change" : "pos-change");
        ODC.innerHTML = sign1+oneDayChange+"%";
        var OC = document.getElementById("overallChange");
        OC.className = (overallChange < 0 ? "neg-change" : "pos-change");
        OC.innerHTML = sign2+overallChange+"%";

        // get Change data
        var change = json_obj_daily.data[0][1] - json_obj_daily.data[1][1];
        change = Number(Math.round(change+'e'+2)+'e-'+2);
        var sign3 = (change < 0 ? "" : "+");
        var CA = document.getElementById("changeAmount");
        CA.className = (changeAmount < 0 ? "neg-change" : "pos-change");
        CA.innerHTML=sign3 + change;
    </script>
    <script>
    // Fill bid and asking prices
        function getData() {
            return $.ajax({
                type: "GET",
                dataType: 'text',
                url: "https://cse134b.herokuapp.com/jm",
                crossDomain : true,
                xhrFields: {
                    withCredentials: false
                }
            });
        }
        function handleData( csvdata ) {
            var bidAskVals = [];
            var jsonAB = eval(csvdata);
            // 0 for gold, 1 for silver, 2 for plat
            document.getElementById("bidVal").innerHTML = jsonAB[0].bid;
            document.getElementById("askVal").innerHTML = jsonAB[0].ask;
            return bidAskVals;
            
        }
        getData().done(handleData);

    // Search Bar Functionality
        $('#search').keyup(function() {
            var table = document.getElementById("gold_table");
            var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();
            for (var i = 1 ; i < table.rows.length; i++){
                var coin = table.rows[i].firstChild.nextSibling.innerHTML.toLowerCase();
                if (i > 0 && coin.includes(val)){
                    //console.log(val);
                    table.rows[i].style.display = "";
                }
                else {
                    table.rows[i].style.display = "none";
                }
            }
        });
    </script>

    <script type="text/javascript" src="js/parse-1.4.2.min.js"></script>
    <script src="js/wire3.js"></script>
    <script src="js/wire4.js"></script>

</html>
